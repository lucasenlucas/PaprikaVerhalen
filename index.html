<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Paprika üå∂Ô∏è ‚Äì Home</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --orange:#ff5722;
      --orange-dark:#d84315;
      --accent:#ffa726;
      --bg:#fff3c4;
      --paper:#fff9e6;
      --ink:#2e1d00;
    }
    *{box-sizing:border-box;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:'Luckiest Guy', cursive;
    }

    header{
      background:var(--orange);
      color:white;
      text-align:center;
      padding:20px;
      font-size:2.2rem;
      box-shadow:0 5px 15px rgba(0,0,0,0.2);
      position:sticky;
      top:0;
      z-index:20;
      text-shadow:3px 3px 0 var(--orange-dark);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding:20px 16px 80px;
    }

    .section{
      margin:30px 0 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      flex-wrap:wrap;
    }
    .section h2{
      margin:0;
      color:var(--orange-dark);
      font-size:1.8rem;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:24px;
    }

    .book{
      background:white;
      border-radius:12px;
      box-shadow:6px 6px 0 var(--accent);
      overflow:hidden;
      transition:transform .2s ease;
      cursor:pointer;
    }
    .book:hover{
      transform:translateY(-5px);
    }
    .book img{
      width:100%;
      aspect-ratio:2/3;
      height:auto;
      object-fit:cover;
      display:block;
    }
    .meta{
      padding:14px;
      font-family:'Merriweather',serif;
    }
    .meta h3{
      margin:0 0 6px;
      font-size:1.3rem;
      color:var(--orange-dark);
      font-family:'Luckiest Guy',cursive;
    }
    .meta p{
      margin:0;
      color:#444;
      font-size:.95rem;
      font-family:'Merriweather',serif;
    }

    .card{
      background:white;
      border-radius:12px;
      box-shadow:6px 6px 0 var(--accent);
      overflow:hidden;
      transition:transform .2s;
      cursor:pointer;
    }
    .card:hover{transform:translateY(-4px);}
    .card img{
      width:100%;
      height:220px;
      object-fit:cover;
    }

    /* Overlay reader */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:16px;
    }
    .overlay.active{display:flex;}
    .reader{
      background:var(--paper);
      width:min(900px,100%);
      max-height:90vh;
      border-radius:16px;
      box-shadow:10px 10px 0 var(--orange-dark);
      display:flex;
      flex-direction:column;
      animation:pop .5s ease forwards;
      overflow:hidden;
    }
    @keyframes pop{
      from{transform:scale(.95) translateY(20px);opacity:0;}
      to{transform:scale(1) translateY(0);opacity:1;}
    }

    .reader header{
      background:var(--orange);
      color:white;
      padding:12px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:1.2rem;
    }
    .reader main{
      flex:1;
      overflow:auto;
      padding:20px;
    }
    .chapter-title{
      font-family:'Luckiest Guy',cursive;
      color:var(--orange-dark);
      font-size:1.4rem;
      margin-top:0;
    }
    .chapter-text{
      font-family:'Merriweather',serif;
      line-height:1.8;
      font-size:1.05rem;
      white-space:pre-wrap;
      color:#222;
    }

    .controls{
      background:#fff3d1;
      border-top:3px solid var(--accent);
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      padding:10px 14px;
    }

    .btn{
      background:var(--orange);
      color:white;
      border:none;
      padding:10px 18px;
      font-size:1rem;
      border-radius:8px;
      font-family:'Luckiest Guy',cursive;
      cursor:pointer;
      box-shadow:4px 4px 0 var(--orange-dark);
      transition:transform .1s;
    }
    .btn:hover{transform:translateY(-2px);}
    .progress{
      flex:1;
      height:8px;
      background:#ffdca2;
      border-radius:10px;
      overflow:hidden;
      margin:0 12px;
      position:relative;
      min-width:100px;
    }
    .bar{
      position:absolute;
      top:0;left:0;bottom:0;
      width:0%;
      background:var(--orange);
    }

    /* Story popup */
    .popup{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:90;
      padding:20px;
    }
    .popup.active{display:flex;}
    .popup .box{
      background:#fff;
      max-width:800px;
      width:100%;
      max-height:90vh;
      overflow:auto;
      padding:24px;
      border-radius:12px;
      box-shadow:8px 8px 0 var(--orange-dark);
    }
    .popup .box h1{
      margin-top:0;
      color:var(--orange-dark);
    }
    .popup .box img{
      width:100%;
      border-radius:8px;
      margin-bottom:16px;
    }

    @media(max-width:640px){
      .book img{aspect-ratio:auto;height:380px;}
      .reader main{padding:16px;}
      .chapter-title{font-size:1.2rem;}
    }
  </style>
</head>
<body>
  <header>üå∂Ô∏è Paprika Verhalen & Boeken</header>

  <main>
    <div class="section">
      <h2>üìö Boeken</h2>
    </div>
    <div class="grid" id="grid-books"></div>

    <div class="section" style="margin-top:40px;">
      <h2>üì∞ Verhalen</h2>
    </div>
    <div class="grid" id="grid-stories"></div>
  </main>

  <!-- BOOK POPUP -->
  <div class="overlay" id="overlay">
    <div class="reader">
      <header>
        <div id="r_info">Titel ‚Ä¢ Auteur</div>
        <button class="btn" id="close">‚úñ Sluiten</button>
      </header>
      <main>
        <img id="r_cover" style="width:100%;border-radius:10px;display:none;margin-bottom:20px;">
        <h3 class="chapter-title" id="c_title"></h3>
        <div class="chapter-text" id="c_text"></div>
      </main>
      <div class="controls">
        <button class="btn" id="prev">‚Üê</button>
        <div class="progress"><div class="bar" id="bar"></div></div>
        <button class="btn" id="next">‚Üí</button>
      </div>
    </div>
  </div>

  <!-- STORY POPUP -->
  <div class="popup" id="storyPopup">
    <div class="box">
      <h1 id="s_title">Titel</h1>
      <img id="s_img" alt="">
      <div id="s_text" class="chapter-text"></div>
      <div style="text-align:right;margin-top:12px;">
        <button class="btn" onclick="document.getElementById('storyPopup').classList.remove('active')">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Firebase + Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDnBGfFwPCypELVQuz5pXF9K77UfL8oyKQ",
      authDomain: "paprika-verhalen-13202.firebaseapp.com",
      projectId: "paprika-verhalen-13202",
      storageBucket: "paprika-verhalen-13202.appspot.com",
      messagingSenderId: "1046216494559",
      appId: "1:1046216494559:web:c13e5edd1da11292dd886a"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const boekenContainer = document.getElementById("grid-books");
    const verhalenContainer = document.getElementById("grid-stories");
    const overlay = document.getElementById("overlay");

    let boeken = [];
    let verhalen = [];
    let actueelBoek = null;
    let hoofdstukIndex = 0;

    async function laadBoeken(){
      const snap = await getDocs(collection(db, "boeken"));
      boeken = [];
      snap.forEach(d=>boeken.push({id:d.id, ...d.data()}));
      renderBoeken();
    }

    async function laadVerhalen(){
      const snap = await getDocs(collection(db, "verhalen"));
      verhalen = [];
      snap.forEach(d=>verhalen.push({id:d.id, ...d.data()}));
      renderVerhalen();
    }

    function renderBoeken(){
      boekenContainer.innerHTML = "";
      boeken.forEach(b=>{
        const el = document.createElement("div");
        el.className = "book";
        el.innerHTML = `
          <img src="${b.omslag || 'https://picsum.photos/800/1200?blur=2'}" alt="${b.titel}">
          <div class="meta">
            <h3>${b.titel}</h3>
            <p>${b.auteur || 'Onbekende auteur'}</p>
          </div>
        `;
        el.addEventListener("click", ()=>openBoek(b));
        boekenContainer.appendChild(el);
      });
    }

    function renderVerhalen(){
      verhalenContainer.innerHTML = "";
      verhalen.forEach(v=>{
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <img src="${v.afbeelding || 'https://picsum.photos/800/400?blur=2'}" alt="${v.titel}">
          <div class="meta">
            <h3>${v.titel}</h3>
            <p>${v.samenvatting || v.verhaal.slice(0,100)+'...'}</p>
          </div>
        `;
        el.addEventListener("click", ()=>openVerhaal(v));
        verhalenContainer.appendChild(el);
      });
    }

    function openBoek(boek){
      actueelBoek = boek;
      hoofdstukIndex = 0;
      document.getElementById("r_info").textContent = `${boek.titel} ‚Ä¢ ${boek.auteur || ''}`;
      document.getElementById("r_cover").src = boek.omslag;
      toonHoofdstuk();
      overlay.classList.add("active");
    }

    function toonHoofdstuk(){
      const cover = document.getElementById("r_cover");
      const cTitle = document.getElementById("c_title");
      const cText = document.getElementById("c_text");
      const bar = document.getElementById("bar");

      if(hoofdstukIndex === 0){
        cover.style.display = "block";
        cTitle.textContent = "Boekcover";
        cText.textContent = "Tik of klik ‚Üí om het eerste hoofdstuk te openen.";
      } else {
        cover.style.display = "none";
        const h = actueelBoek.hoofdstukken[hoofdstukIndex-1];
        cTitle.textContent = h.titel || `Hoofdstuk ${hoofdstukIndex}`;
        cText.textContent = h.tekst || "";
      }

      const total = (actueelBoek.hoofdstukken?.length || 0) + 1;
      bar.style.width = `${(hoofdstukIndex / total) * 100}%`;
    }

    document.getElementById("next").addEventListener("click", ()=>{
      const total = (actueelBoek.hoofdstukken?.length || 0) + 1;
      hoofdstukIndex = Math.min(total-1, hoofdstukIndex+1);
      toonHoofdstuk();
    });
    document.getElementById("prev").addEventListener("click", ()=>{
      hoofdstukIndex = Math.max(0, hoofdstukIndex-1);
      toonHoofdstuk();
    });
    document.getElementById("close").addEventListener("click", ()=>overlay.classList.remove("active"));
    overlay.addEventListener("click", e=>{
      if(e.target===overlay) overlay.classList.remove("active");
    });

    function openVerhaal(v){
      document.getElementById("s_title").textContent = v.titel;
      document.getElementById("s_img").src = v.afbeelding || 'https://picsum.photos/800/400?blur=2';
      document.getElementById("s_text").textContent = v.verhaal || v.samenvatting;
      document.getElementById("storyPopup").classList.add("active");
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      laadBoeken();
      laadVerhalen();
    });
  </script>
</body>
</html>
